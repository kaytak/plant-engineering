"use strict";(self.webpackChunkengineering_com=self.webpackChunkengineering_com||[]).push([[86],{86:(H,E,p)=>{p.r(E),p.d(E,{default:()=>x});var S=p(861),x={name:"markers",init(){var y=this;return(0,S.Z)(function*(){const{svgCanvas:s}=y,{BatchCommand:M,RemoveElementCommand:N,InsertElementCommand:T}=s.history,{$id:u,addSVGElementsFromJson:f}=s,m=["start","mid","end"],Z=["line","path","polyline","polygon"],d={nomarker:{},leftarrow:{element:"path",attr:{d:"M0,50 L100,90 L70,50 L100,10 Z"}},rightarrow:{element:"path",attr:{d:"M100,50 L0,90 L30,50 L0,10 Z"}},box:{element:"path",attr:{d:"M20,20 L20,80 L80,80 L80,20 Z"}},mcircle:{element:"circle",attr:{r:30,cx:50,cy:50}}};["leftarrow","rightarrow","box","mcircle"].forEach(n=>{d[n+"_o"]=d[n]});const h=(n,e)=>{const r=n.getAttribute(e);if(!r)return null;const t=r.match(/\(#(.*)\)/);return t&&2===t.length?s.getElement(t[1]):null},k=(n,e)=>{u("marker_panel").style.display=n?"block":"none",n&&e&&m.forEach(r=>{var t;const i=h(e,"marker-"+r);null!=i&&null!==(t=i.attributes)&&void 0!==t&&t.se_type?u("".concat(r,"_marker_list_opts")).setAttribute("value",i.attributes.se_type.value):u("".concat(r,"_marker_list_opts")).setAttribute("value","nomarker")})},w=(n,e)=>{const r=s.getSelectedElements();let t=s.getElement(n);if(t||""===e||"nomarker"===e)return;const i=r[0].getAttribute("stroke");if(!d[e])return void console.error("unknown marker type: ".concat(e));t=f({element:"marker",attr:{id:n,markerUnits:"strokeWidth",orient:"auto",style:"pointer-events:none",se_type:e}});const a=f(d[e]),l="_o"===e.substr(-2)?"none":i;return a.setAttribute("fill",l),a.setAttribute("stroke",i),a.setAttribute("stroke-width",10),t.append(a),t.setAttribute("viewBox","0 0 100 100"),t.setAttribute("markerWidth",5),t.setAttribute("markerHeight",5),t.setAttribute("refX",50),t.setAttribute("refY",50),s.findDefs().append(t),t};return{name:y.i18next.t("".concat(name,":name")),callback(){const n=document.createElement("template");let e='<div id="marker_panel">';m.forEach(r=>{e+='<se-list id="'.concat(r,'_marker_list_opts" title="tools.').concat(r,'_marker_list_opts" label="" width="22px" height="22px">'),Object.entries(d).forEach(t=>{let[i,a]=t;e+='<se-list-item id="mkr_'.concat(r,"_").concat(i,'" value="').concat(i,'" title="tools.mkr_').concat(i,'" src="').concat(i,'.svg" img-height="22px"></se-list-item>')}),e+="</se-list>"}),e+="</div>",n.innerHTML=e,u("tools_top").appendChild(n.content.cloneNode(!0)),k(!1),m.forEach(r=>{u("".concat(r,"_marker_list_opts")).addEventListener("change",t=>{((n,e)=>{const r=s.getSelectedElements();if(0===r.length)return;const t="marker-"+n,i=r[0],a=h(i,t);a&&a.remove(),i.removeAttribute(t);let l=e;if(""===l&&(l="nomarker"),"nomarker"===l)return void s.call("changed",r);const c="mkr_"+n+"_"+i.id;w(c,l),s.changeSelectedAttribute(t,"url(#"+c+")"),"line"===i.tagName&&"mid"===n&&(o=>{if("line"!==o.tagName)return o;const _=Number(o.getAttribute("x1")),b=Number(o.getAttribute("x2")),C=Number(o.getAttribute("y1")),L=Number(o.getAttribute("y2")),{id:B}=o,g=f({element:"polyline",attr:{points:_+","+C+" "+(_+b)/2+","+(C+L)/2+" "+b+","+L,stroke:o.getAttribute("stroke"),"stroke-width":o.getAttribute("stroke-width"),fill:"none",opacity:o.getAttribute("opacity")||1}});m.forEach(D=>{const v="marker-"+D;o.getAttribute(v)&&g.setAttribute(v,o.getAttribute(v))});const A=new M;A.addSubCommand(new N(o,o.parentNode)),A.addSubCommand(new T(g)),o.insertAdjacentElement("afterend",g),o.remove(),s.clearSelection(),g.id=B,s.addToSelection([g]),s.addCommandToHistory(A)})(i),s.call("changed",r)})(r,t.detail.value)})})},selectedChanged(n){0===n.elems.length&&k(!1),n.elems.forEach(e=>{e&&Z.includes(e.tagName)&&n.selectedElement&&!n.multiselected?k(!0,e):k(!1)})},elementChanged(n){const e=n.elems[0];e&&(e.getAttribute("marker-start")||e.getAttribute("marker-mid")||e.getAttribute("marker-end"))&&((r=>{const t=r.getAttribute("stroke");m.forEach(i=>{const a=h(r,"marker-"+i);if(!a||!a.attributes.se_type)return;const l=a.lastElementChild;if(!l)return;const c=l.getAttribute("fill"),o=l.getAttribute("stroke");c&&"none"!==c&&l.setAttribute("fill",t),o&&"none"!==o&&l.setAttribute("stroke",t)})})(e),(r=>{const t=s.getSelectedElements();m.forEach(i=>{const a="marker-"+i,l=h(r,a);if(!l||!l.attributes.se_type)return;const c=r.getAttribute(a);if(c){const o=r.id.length,_=c.substr(-o-1,o);if(r.id!==_){const b="mkr_"+i+"_"+r.id;w(b,l.attributes.se_type.value),s.changeSelectedAttribute(a,"url(#"+b+")"),s.call("changed",t)}}})})(e))}}})()}}}}]);