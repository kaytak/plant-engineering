"use strict";(self.webpackChunkengineering_com=self.webpackChunkengineering_com||[]).push([[29],{29:(ge,N,O)=>{O.r(N),O.d(N,{default:()=>ce});var c=O(861);function X(i){var e,t,r,n=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,r=Symbol.iterator);n--;){if(t&&null!=(e=i[t]))return e.call(i);if(r&&null!=(e=i[r]))return new k(e.call(i));t="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function k(i){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var r=t.done;return Promise.resolve(t.value).then(function(n){return{value:n,done:r}})}return(k=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return void 0===n?Promise.resolve({value:r,done:!0}):e(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return void 0===n?Promise.reject(r):e(n.apply(this.s,arguments))}},new k(i)}var Y=Object.defineProperty,w=(i,e)=>()=>(i&&(e=i(i=0)),e),x=(i,e)=>{for(var t in e)Y(i,t,{get:e[t],enumerable:!0})},L={};x(L,{default:()=>F});var F,ee=w(()=>{F=function(){var i=(0,c.Z)(function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{}];return Array.isArray(e)||(e=[e]),new Promise((t,r)=>{let n=document.createElement("input");n.type="file";let s=[...e.map(u=>u.mimeTypes||[]).join(),e.map(u=>u.extensions||[]).join()].join();n.multiple=e[0].multiple||!1,n.accept=s||"";let l=u=>{"function"==typeof a&&a(),t(u)},a=e[0].legacySetup&&e[0].legacySetup(l,()=>a(r),n);n.addEventListener("change",()=>{l(n.multiple?Array.from(n.files):n.files[0])}),n.click()})});return function(){return i.apply(this,arguments)}}()}),D={};x(D,{default:()=>z});var U,z,te=w(()=>{U=function(){var i=(0,c.Z)(function*(e){let t=yield e.getFile();return t.handle=e,t});return function(t){return i.apply(this,arguments)}}(),z=function(){var i=(0,c.Z)(function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{}];Array.isArray(e)||(e=[e]);let t=[];e.forEach((s,l)=>{t[l]={description:s.description||"",accept:{}},s.mimeTypes?s.mimeTypes.map(a=>{t[l].accept[a]=s.extensions||[]}):t[l].accept["*/*"]=s.extensions||[]});let r=yield window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),n=yield Promise.all(r.map(U));return e[0].multiple?n:n[0]});return function(){return i.apply(this,arguments)}}()}),G={};x(G,{default:()=>V});var V,ne=w(()=>{V=function(){var i=(0,c.Z)(function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{}];return Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,r)=>{let n=document.createElement("input");n.type="file",n.webkitdirectory=!0;let s=a=>{"function"==typeof l&&l(),t(a)},l=e[0].legacySetup&&e[0].legacySetup(s,()=>l(r),n);n.addEventListener("change",()=>{let a=Array.from(n.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(a=a.filter(u=>u.webkitRelativePath.split("/").every(p=>!e[0].skipDirectory({name:p,kind:"directory"})))):a=a.filter(u=>2===u.webkitRelativePath.split("/").length),s(a)}),n.click()})});return function(){return i.apply(this,arguments)}}()}),M={};x(M,{default:()=>H});var I,H,re=w(()=>{I=function(){var i=(0,c.Z)(function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.name,n=arguments.length>3?arguments[3]:void 0,s=[],l=[];var p,a=!1,u=!1;try{for(var m,v=X(e.values());a=!(m=yield v.next()).done;a=!1){let o=m.value,d="".concat(r,"/").concat(o.name);"file"===o.kind?l.push(o.getFile().then(f=>(f.directoryHandle=e,f.handle=o,Object.defineProperty(f,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):"directory"===o.kind&&t&&(!n||!n(o))&&s.push(I(o,t,d,n))}}catch(o){u=!0,p=o}finally{try{a&&null!=v.return&&(yield v.return())}finally{if(u)throw p}}return[...(yield Promise.all(s)).flat(),...yield Promise.all(l)]});return function(t,r){return i.apply(this,arguments)}}(),H=function(){var i=(0,c.Z)(function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.recursive=e.recursive||!1;let t=yield window.showDirectoryPicker({id:e.id,startIn:e.startIn});return I(t,e.recursive,void 0,e.skipDirectory)});return function(){return i.apply(this,arguments)}}()}),$={};function ie(i,e){return T.apply(this,arguments)}function T(){return T=(0,c.Z)(function*(i,e){let t=i.getReader(),r=new ReadableStream({start:s=>function(){var l=(0,c.Z)(function*(){return t.read().then(u=>{let{done:p,value:v}=u;if(!p)return s.enqueue(v),a();s.close()})});function a(){return l.apply(this,arguments)}return a}()()}),n=new Response(r);return t.releaseLock(),new Blob([yield n.blob()],{type:e})}),T.apply(this,arguments)}x($,{default:()=>B});var B,ae=w(()=>{B=function(){var i=(0,c.Z)(function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Array.isArray(t)&&(t=t[0]);let r=document.createElement("a"),n=e;"body"in e&&(n=yield ie(e.body,e.headers.get("content-type"))),r.download=t.fileName||"Untitled",r.href=URL.createObjectURL(n);let s=()=>a(reject),l=()=>{"function"==typeof a&&a()},a=t.legacySetup&&t.legacySetup(l,s,r);return r.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(r.href),3e4),l()}),r.click(),null});return function(t){return i.apply(this,arguments)}}()}),W={};x(W,{default:()=>q});var q,oe=w(()=>{q=function(){var i=(0,c.Z)(function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[{}],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";let s=[];if(t.forEach((u,p)=>{s[p]={description:u.description||"",accept:{}},u.mimeTypes?(0===p&&(e.type?u.mimeTypes.push(e.type):e.headers&&e.headers.get("content-type")&&u.mimeTypes.push(e.headers.get("content-type"))),u.mimeTypes.map(v=>{s[p].accept[v]=u.extensions||[]})):e.type&&(s[p].accept[e.type]=u.extensions||[])}),r)try{yield r.getFile()}catch(u){if(r=null,n)throw u}let l=r||(yield window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1})),a=yield l.createWritable();return"stream"in e?(yield e.stream().pipeTo(a),l):"body"in e?(yield e.body.pipeTo(a),l):(yield a.write(blob),yield a.close(),l)});return function(t){return i.apply(this,arguments)}}()}),j=(()=>{if("undefined"==typeof self)return!1;if("top"in self&&self!==top)try{top}catch(i){return!1}else if("showOpenFilePicker"in self)return"showOpenFilePicker";return!1})(),se=j?Promise.resolve().then(()=>(te(),D)):Promise.resolve().then(()=>(ee(),L));j?Promise.resolve().then(()=>(re(),M)):Promise.resolve().then(()=>(ne(),G));var le=j?Promise.resolve().then(()=>(oe(),W)):Promise.resolve().then(()=>(ae(),$));function J(){return R.apply(this,arguments)}function R(){return R=(0,c.Z)(function*(){return(yield le).default(...arguments)}),R.apply(this,arguments)}const Z="opensave";let _=null;const ue=function(){var i=(0,c.Z)(function*(e){let t;const r=e.configObj.pref("lang");try{t=yield function(s){switch(s){case"./locale/en.js":return Promise.resolve().then(function(){return Q});case"./locale/fr.js":return Promise.resolve().then(function(){return de});case"./locale/zh-CN.js":return Promise.resolve().then(function(){return me});default:return new Promise(function(l,a){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+s)))})}}("./locale/".concat(r,".js"))}catch(n){console.warn("Missing translation (".concat(r,") for ").concat(Z," - using 'en'")),t=yield Promise.resolve().then(function(){return Q})}e.i18next.addResourceBundle(r,"translation",t.default,!0,!0)});return function(t){return i.apply(this,arguments)}}();var ce={name:Z,init(i){var e=this;return(0,c.Z)(function*(){const t=e,{svgCanvas:r}=t,{$id:n,$click:s}=r;yield ue(t);const l=m=>{n("se-prompt-dialog").title=e.i18next.t("notification.loadingImage"),n("se-prompt-dialog").setAttribute("close",!1),m.stopPropagation(),m.preventDefault();const o="drop"===m.type?m.dataTransfer.files[0]:m.currentTarget.files[0];if(!o)return void n("se-prompt-dialog").setAttribute("close",!0);if(!o.type.includes("image"))return;let d;o.type.includes("svg")?(d=new FileReader,d.onloadend=f=>{const y=e.svgCanvas.importSvgString(f.target.result,!0);e.svgCanvas.alignSelectedElements("m","page"),e.svgCanvas.alignSelectedElements("c","page"),e.svgCanvas.selectOnly([y]),n("se-prompt-dialog").setAttribute("close",!0)},d.readAsText(o)):(d=new FileReader,d.onloadend=function(f){let{target:{result:y}}=f;const h=(C,P)=>{const S=this.svgCanvas.addSVGElementsFromJson({element:"image",attr:{x:0,y:0,width:C,height:P,id:this.svgCanvas.getNextId(),style:"pointer-events:inherit"}});this.svgCanvas.setHref(S,y),this.svgCanvas.selectOnly([S]),this.svgCanvas.alignSelectedElements("m","page"),this.svgCanvas.alignSelectedElements("c","page"),this.topPanel.updateContextPanel(),n("se-prompt-dialog").setAttribute("close",!0)};let A=100,b=100;const g=new Image;g.style.opacity=0,g.addEventListener("load",()=>{A=g.offsetWidth||g.naturalWidth||g.width,b=g.offsetHeight||g.naturalHeight||g.height,h(A,b)}),g.src=y},d.readAsDataURL(o))},a=document.createElement("input");a.type="file",a.addEventListener("change",l),e.workarea.addEventListener("drop",l);const u=function(){var m=(0,c.Z)(function*(){const[o,d]=t.configObj.curConfig.dimensions;"Cancel"!==(yield seConfirm(t.i18next.t("notification.QwantToClear")))&&(t.leftPanel.clickSelect(),t.svgCanvas.clear(),t.svgCanvas.setResolution(o,d),t.updateCanvas(!0),t.zoomImage(),t.layersPanel.populateLayers(),t.topPanel.updateContextPanel(),t.topPanel.updateTitle("untitled.svg"),t.svgCanvas.runExtensions("onNewDocument"))});return function(){return m.apply(this,arguments)}}(),p=function(){var m=(0,c.Z)(function*(){if("Cancel"!==(yield t.openPrep())){r.clear();try{const o=yield(f=(0,c.Z)(function*(){return(yield se).default(...arguments)}),function y(){return f.apply(this,arguments)})({mimeTypes:["image/*"]}),d=yield o.text();yield t.loadSvgString(d),t.updateCanvas(),_=o.handle,t.topPanel.updateTitle(o.name),t.svgCanvas.runExtensions("onOpenedDocument",{name:o.name,lastModified:o.lastModified,size:o.size,type:o.type})}catch(o){if("AbortError"!==o.name)return console.error(o)}}var f});return function(){return m.apply(this,arguments)}}(),v=function(){var m=(0,c.Z)(function*(o){if("open"===n("se-svg-editor-dialog").getAttribute("dialog"))t.saveSourceEditor();else{const d={images:t.configObj.pref("img_save"),round_digits:6};if(r.clearSelection(),d){const h=r.mergeDeep(r.getSvgOption(),d);for(const[A,b]of Object.entries(h))r.setSvgOption(A,b)}r.setSvgOption("apply",!0);const f='<?xml version="1.0"?>\n'+r.svgCanvasToString(),y=function(h){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;const g=atob(h),C=[];for(let P=0;P<g.length;P+=b){const S=g.slice(P,P+b),K=new Array(S.length);for(let E=0;E<S.length;E++)K[E]=S.charCodeAt(E);const pe=new Uint8Array(K);C.push(pe)}return new Blob(C,{type:A})}(r.encode64(f),"image/svg+xml");try{_="save"===o&&null!==_?yield J(y,{fileName:"untitled.svg",extensions:[".svg"]},_,!1):yield J(y,{fileName:t.title,extensions:[".svg"]}),t.topPanel.updateTitle(_.name),r.runExtensions("onSavedDocument",{name:_.name,kind:_.kind})}catch(h){if("AbortError"!==h.name)return console.error(h)}}});return function(d){return m.apply(this,arguments)}}();return{name:t.i18next.t("".concat(Z,":name")),callback(){r.insertChildAtIndex(n("main_button"),'\n        <se-menu-item id="tool_clear" label="opensave.new_doc" shortcut="N" src="new.svg"></se-menu-item>',0),r.insertChildAtIndex(n("main_button"),'<se-menu-item id="tool_open" label="opensave.open_image_doc" src="open.svg"></se-menu-item>',1),r.insertChildAtIndex(n("main_button"),'<se-menu-item id="tool_save" label="opensave.save_doc" shortcut="S" src="saveImg.svg"></se-menu-item>',2),r.insertChildAtIndex(n("main_button"),'<se-menu-item id="tool_save_as" label="opensave.save_as_doc" src="saveImg.svg"></se-menu-item>',3),r.insertChildAtIndex(n("main_button"),'<se-menu-item id="tool_import" label="tools.import_doc" src="importImg.svg"></se-menu-item>',4),s(n("tool_clear"),u.bind(this)),s(n("tool_open"),p.bind(this)),s(n("tool_save"),v.bind(this,"save")),s(n("tool_save_as"),v.bind(this,"saveas")),s(n("tool_import"),()=>a.click())}}})()}},Q=Object.freeze({__proto__:null,default:{opensave:{new_doc:"New Image",open_image_doc:"Open SVG",save_doc:"Save SVG",save_as_doc:"Save as SVG"}}}),de=Object.freeze({__proto__:null,default:{opensave:{new_doc:"Nouvelle image",open_image_doc:"Ouvrir le SVG",save_doc:"Enregistrer l'image",save_as_doc:"Enregistrer en tant qu'image"}}}),me=Object.freeze({__proto__:null,default:{opensave:{new_doc:"\u65b0\u56fe\u7247",open_image_doc:"\u6253\u5f00 SVG",save_doc:"\u4fdd\u5b58\u56fe\u50cf",save_as_doc:"\u53e6\u5b58\u4e3a\u56fe\u50cf"}}})}}]);